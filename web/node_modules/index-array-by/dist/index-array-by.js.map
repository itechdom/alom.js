{"version":3,"file":"index-array-by.js","sources":["../src/index.js"],"sourcesContent":["export default (list, keyAccessors, multiItem = true, flattenKeys = false) => {\n\n  const keys = (keyAccessors instanceof Array ? keyAccessors : [keyAccessors]).map(key => ({\n    keyAccessor: key,\n    isProp: !(key instanceof Function)\n  }));\n\n  const indexedResult = list.reduce((res, item) => {\n    let iterObj = res;\n    let itemVal = item;\n\n    keys.forEach(({ keyAccessor, isProp }, idx) => {\n      let key;\n      if (isProp) {\n        const { [keyAccessor]: propVal, ...rest } = itemVal;\n        key = propVal;\n        itemVal = rest;\n      } else {\n        key = keyAccessor(itemVal, idx);\n      }\n\n      if (idx + 1 < keys.length) {\n        if (!iterObj.hasOwnProperty(key)) {\n          iterObj[key] = {};\n        }\n        iterObj = iterObj[key];\n      } else { // Leaf key\n        if (multiItem) {\n          if (!iterObj.hasOwnProperty(key)) {\n            iterObj[key] = [];\n          }\n          iterObj[key].push(itemVal);\n        } else {\n          iterObj[key] = itemVal;\n        }\n      }\n    });\n    return res;\n  }, {});\n\n  if (multiItem  instanceof Function) {\n    // Reduce leaf multiple values\n    (function reduce(node, level = 1) {\n      if (level === keys.length) {\n        Object.keys(node).forEach(k => node[k] = multiItem(node[k]));\n      } else {\n        Object.values(node).forEach(child => reduce(child, level + 1));\n      }\n    })(indexedResult); // IIFE\n  }\n\n  let result = indexedResult;\n\n  if (flattenKeys) {\n    // flatten into array\n    result = [];\n\n    (function flatten(node, accKeys = []) {\n      if (accKeys.length === keys.length) {\n        result.push({\n          keys: accKeys,\n          vals: node\n        });\n      } else {\n        Object.entries(node)\n          .forEach(([key, val]) => flatten(val, [...accKeys, key]));\n      }\n    })(indexedResult); //IIFE\n  }\n\n  return result;\n}\n"],"names":["list","keyAccessors","multiItem","flattenKeys","keys","Array","map","key","keyAccessor","isProp","Function","indexedResult","reduce","res","item","iterObj","itemVal","forEach","idx","propVal","rest","length","hasOwnProperty","push","node","level","Object","k","values","child","result","flatten","accKeys","vals","entries","val"],"mappings":"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"}